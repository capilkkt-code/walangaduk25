<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Walangaduk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#31326F'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #31326F 0%, #4A4B8C 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(49, 50, 111, 0.1);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-3xl font-bold">🌊 Aplikasi Walangaduk</h1>
            <p class="mt-2">Layanan Registrasi Administrasi Kependudukan Kabupaten Kepulauan Tanimbar</p>
        </div>
    </header>

    <!-- Navigasi -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 flex justify-between items-center py-3">
            <div class="text-primary font-bold">📱 Menu</div>
            <div class="space-x-3">
                <button onclick="showPage('dashboard')" class="px-4 py-2 bg-primary text-white rounded">Dashboard</button>
                <button onclick="checkLoginAndShowRegistrasi()" class="px-4 py-2 border border-primary text-primary rounded">Registrasi</button>
                <button onclick="showPage('tentang')" class="px-4 py-2 border border-primary text-primary rounded">Tentang</button>
                <button onclick="showPage('kontak')" class="px-4 py-2 border border-primary text-primary rounded">Kontak</button>
                <button id="logoutBtnDesktop" onclick="logout()" class="hidden px-4 py-2 bg-red-500 text-white rounded">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Dashboard -->
    <div id="dashboard" class="page-content">
        <div class="container mx-auto px-4 py-10 text-center">
            <h2 class="text-2xl font-bold mb-4">Selamat Datang 👋</h2>
            <p class="text-gray-600">Silakan gunakan menu di atas untuk melanjutkan.</p>
        </div>
    </div>

    <!-- Login -->
    <div id="login" class="page-content hidden">
        <div class="container mx-auto px-4 py-10 max-w-md">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold text-primary mb-4">🔐 Login Petugas</h2>
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm mb-1">Username</label>
                        <input type="text" name="username" required class="w-full px-3 py-2 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm mb-1">Password</label>
                        <input type="password" name="password" required class="w-full px-3 py-2 border rounded">
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-2 rounded">Masuk</button>
                </form>
                <div id="loginDebugInfo" class="mt-4 text-xs text-blue-600 bg-blue-100 p-2 rounded">
                    Memuat data login...
                </div>
            </div>
        </div>
    </div>

    <!-- Registrasi -->
    <div id="registrasi" class="page-content hidden">
        <div class="container mx-auto px-4 py-10 max-w-lg">
            <div class="flex justify-between items-center mb-4">
                <p class="text-sm">Login sebagai: <span id="loggedInUser" class="font-bold text-primary">-</span></p>
                <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded">Logout</button>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4 text-primary">📝 Form Registrasi</h2>
                <form id="registrationForm" class="space-y-4">
                    <div>
                        <label class="block text-sm mb-1">Nama Petugas</label>
                        <input type="text" name="namapetugas" class="w-full px-3 py-2 border rounded" required>
                    </div>
                    <div>
                        <label class="block text-sm mb-1">Nama Pemohon</label>
                        <input type="text" name="namapemohon" class="w-full px-3 py-2 border rounded" required>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-2 rounded">Kirim</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Tentang -->
    <div id="tentang" class="page-content hidden">
        <div class="container mx-auto px-4 py-10 max-w-2xl text-center">
            <h2 class="text-2xl font-bold text-primary mb-4">🌟 Tentang Walangaduk</h2>
            <p class="text-gray-600">Aplikasi inovatif untuk mempermudah layanan administrasi kependudukan di Kabupaten Kepulauan Tanimbar.</p>
        </div>
    </div>

    <!-- Kontak -->
    <div id="kontak" class="page-content hidden">
        <div class="container mx-auto px-4 py-10 max-w-2xl text-center">
            <h2 class="text-2xl font-bold text-primary mb-4">📞 Kontak Kami</h2>
            <p class="text-gray-600">Email: dukcapil@tanimbar.go.id<br>Telp: +62-xxx-xxxx-xxxx</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-4 mt-10">
        <div class="container mx-auto px-4 text-center text-sm">
            &copy; 2025 Aplikasi Walangaduk - Disdukcapil Kabupaten Kepulauan Tanimbar
        </div>
    </footer>

    <!-- Script -->
    <script>
        // Variabel global
        let loginCredentials = [];
        let isLoggedIn = false;
        let currentUser = null;

        // URL database login (Google Sheets CSV)
        const loginSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQe1VRxHbaCptL3iB_UUitoRw_BF6DRWSuUw3-w5evnSe-nxUPGLKo7TNSjy8rwL8r0nL5RHmK2ALiy/pub?gid=0&single=true&output=csv";

        // Load data login dari Google Sheets
        async function loadLoginData() {
            try {
                const response = await fetch(loginSheetUrl);
                const text = await response.text();
                const rows = text.split("\n").map(r => r.split(","));
                loginCredentials = rows.slice(1).map(row => ({
                    username: row[0]?.trim(),
                    password: row[1]?.trim()
                }));
                document.getElementById("loginDebugInfo").innerHTML =
                    `<span class="text-green-600">✅ Data login berhasil dimuat (${loginCredentials.length} akun)</span>`;
            } catch (error) {
                console.error("Gagal memuat data login:", error);
                document.getElementById("loginDebugInfo").innerHTML =
                    `<span class="text-red-600">❌ Gagal memuat data login</span>`;
            }
        }

        // Fungsi login
        document.getElementById("loginForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const username = formData.get("username").trim();
            const password = formData.get("password").trim();

            const user = loginCredentials.find(
                cred => cred.username === username && cred.password === password
            );

            if (user) {
                isLoggedIn = true;
                currentUser = username;
                document.getElementById("loggedInUser").innerText = username;
                showPage("registrasi");
                document.getElementById("logoutBtnDesktop").classList.remove("hidden");
            } else {
                alert("⚠️ Username atau password salah!");
            }
        });

        // Logout
        function logout() {
            isLoggedIn = false;
            currentUser = null;
            document.getElementById("loggedInUser").innerText = "-";
            showPage("login");
            document.getElementById("logoutBtnDesktop").classList.add("hidden");
        }

        // Navigasi
        function showPage(pageId) {
            document.querySelectorAll(".page-content").forEach(p => p.classList.add("hidden"));
            document.getElementById(pageId).classList.remove("hidden");
        }

        function checkLoginAndShowRegistrasi() {
            if (isLoggedIn) {
                showPage("registrasi");
            } else {
                showPage("login");
            }
        }

        // Jalankan load login data saat awal
        loadLoginData();
    </script>
</body>
</html>
